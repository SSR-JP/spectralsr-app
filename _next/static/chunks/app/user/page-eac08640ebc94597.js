(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3797],{6102:function(e,t,r){Promise.resolve().then(r.bind(r,5411))},5411:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return P}});var n=r(9241),o=r(4299),a=r(3460),c=r(9998),i=r(6091),s=r(3098),l=r(8153),u=r(9528),d=r(7437),p=(0,u.Z)((0,d.jsx)("path",{d:"M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42a.9959.9959 0 0 0-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1"}),"ArrowBackRounded"),h=r(1638),v=(0,u.Z)((0,d.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3z"}),"Launch"),f=r(1733),m=r(2305),g=r(9806),y=r(335),Z=r(511),b=r(6548),x=r(6463),S=r(5041),C=r(2265);function P(){let[e]=(0,a.fl)(),t=(0,l.PQ)(l.YI.primary.getArgb(e.scheme)),r=(0,l.PQ)(l.YI.surface.getArgb(e.scheme)),u=(0,l.PQ)(l.YI.surfaceContainer.getArgb(e.scheme));(0,l.PQ)(l.YI.onSurface.getArgb(e.scheme));let d=(0,l.PQ)(l.YI.onSurfaceVariant.getArgb(e.scheme)),P=(0,x.useRouter)(),[k,w]=(0,C.useState)("---"),[B]=(0,o.mN)(),{waitingForPayment:I,purchaseRunning:z,handlePurchase:E,handleCancelPayment:R}=(0,i.s)({onPaymentSuccess:()=>{A()}}),A=async()=>{let e=B.apiGatewayUrl,t=B.apiClient.getAccessToken();try{let r=await fetch("".concat(e,"/tickets/balance"),{headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let n=await r.json();w(n.ticket_balance.toFixed(0))}catch(e){console.error("Failed to fetch ticket count:",e),(0,S.yv)("チケットの取得に失敗しました。",{variant:"error"})}};return(0,C.useEffect)(()=>{"connected"===B.serviceStatus&&A()},[B.serviceStatus]),(0,n.BX)("div",{css:(0,s.iv)({}),children:[(0,n.tZ)(f.Z,{position:"fixed",elevation:0,css:(0,s.iv)({backgroundColor:(0,m.Fq)(r,.5),backdropFilter:"blur(16px)",color:t}),children:(0,n.BX)(g.Z,{children:[(0,n.tZ)(y.Z,{size:"large",edge:"start",color:"inherit",onClick:()=>{P.back()},children:(0,n.tZ)(p,{})}),(0,n.tZ)(Z.Z,{variant:"h6",css:(0,s.iv)({fontWeight:"bold"}),children:"ユーザ情報"})]})}),(0,n.BX)("div",{css:(0,s.iv)({display:"flex",flexDirection:"column",marginTop:"80px",paddingLeft:"16px",paddingRight:"16px",marginLeft:"auto",marginRight:"auto",maxWidth:"1040px"}),children:[(0,n.BX)(n.HY,{children:[(0,n.tZ)(Z.Z,{variant:"h6",css:(0,s.iv)({fontWeight:"bold"}),children:"チケット"}),(0,n.BX)("div",{css:(0,s.iv)({display:"flex",flexDirection:"column",alignSelf:"center",width:"100%",maxWidth:"288px"}),children:[(0,n.BX)("div",{css:(0,s.iv)({alignItems:"center",alignSelf:"center",padding:"8px",display:"flex",flexDirection:"row"}),children:[(0,n.tZ)(h.Z,{}),(0,n.tZ)("span",{css:(0,s.iv)({}),children:"残り"}),(0,n.BX)("span",{css:(0,s.iv)({paddingLeft:"8px",fontSize:"24px"}),children:[k,"枚"]})]}),(0,n.tZ)(b.Z,{css:(0,s.iv)({}),variant:"contained",onClick:E,disabled:z||I,children:I?"決済処理中...":z?"処理中...":"チケットを購入"})]})]}),(0,n.BX)("div",{css:(0,s.iv)({marginTop:48,paddingBottom:32}),children:[(0,n.tZ)(Z.Z,{variant:"h6",css:(0,s.iv)({fontWeight:"bold",marginBottom:16,display:"flex",alignItems:"center",gap:8}),children:"アプリ情報"}),(0,n.BX)("div",{css:(0,s.iv)({display:"flex",flexDirection:"column",gap:16,backgroundColor:u,padding:20,borderRadius:12}),children:[(0,n.BX)("div",{children:[(0,n.tZ)(Z.Z,{variant:"subtitle2",css:(0,s.iv)({color:d,marginBottom:4}),children:"アプリ名"}),(0,n.tZ)(Z.Z,{variant:"body1",children:"SpectralSR"})]}),(0,n.BX)("div",{children:[(0,n.tZ)(Z.Z,{variant:"subtitle2",css:(0,s.iv)({color:d,marginBottom:4}),children:"バージョン"}),(0,n.tZ)(Z.Z,{variant:"body1",children:"1.0.0-alpha"})]}),(0,n.BX)("div",{children:[(0,n.tZ)(Z.Z,{variant:"subtitle2",css:(0,s.iv)({color:d,marginBottom:8}),children:"リンク"}),(0,n.BX)("div",{css:(0,s.iv)({display:"flex",flexDirection:"column",gap:12}),children:[(0,n.BX)("a",{href:"https://spectralsr.com/",target:"_blank",rel:"noopener noreferrer",css:(0,s.iv)({color:t,textDecoration:"none",fontSize:"16px",display:"flex",alignItems:"center",gap:4,"&:hover":{textDecoration:"underline"}}),children:["ホームページ ",(0,n.tZ)(v,{fontSize:"small"})]}),(0,n.BX)("a",{href:"https://spectralsr.com/spectrumdir/wp-content/uploads/SSRKK_Privacy-policy_20250625.pdf",target:"_blank",rel:"noopener noreferrer",css:(0,s.iv)({color:t,textDecoration:"none",fontSize:"16px",display:"flex",alignItems:"center",gap:4,"&:hover":{textDecoration:"underline"}}),children:["プライバシーポリシー ",(0,n.tZ)(v,{fontSize:"small"})]})]})]})]})]})]}),I&&(0,n.tZ)(c.Z,{onCancel:R})]})}},1638:function(e,t,r){"use strict";var n=r(9528),o=r(7437);t.Z=(0,n.Z)((0,o.jsx)("path",{d:"M22 10V6c0-1.11-.9-2-2-2H4c-1.1 0-1.99.89-1.99 2v4c1.1 0 1.99.9 1.99 2s-.89 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2m-9 7.5h-2v-2h2zm0-4.5h-2v-2h2zm0-4.5h-2v-2h2z"}),"ConfirmationNumber")},137:function(e,t,r){"use strict";var n=r(9528),o=r(7437);t.Z=(0,n.Z)((0,o.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16zm0-10H4V6h16z"}),"Payment")},335:function(e,t,r){"use strict";r.d(t,{Z:function(){return x}});var n=r(3950),o=r(2988),a=r(2265),c=r(4839),i=r(6990),s=r(317),l=r(8024),u=r(5885),d=r(9022),p=r(2272),h=r(2296),v=r(587);function f(e){return(0,v.ZP)("MuiIconButton",e)}let m=(0,h.Z)("MuiIconButton",["root","disabled","colorInherit","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","edgeStart","edgeEnd","sizeSmall","sizeMedium","sizeLarge"]);var g=r(7437);let y=["edge","children","className","color","disabled","disableFocusRipple","size"],Z=e=>{let{classes:t,disabled:r,color:n,edge:o,size:a}=e,c={root:["root",r&&"disabled","default"!==n&&"color".concat((0,p.Z)(n)),o&&"edge".concat((0,p.Z)(o)),"size".concat((0,p.Z)(a))]};return(0,i.Z)(c,f,t)},b=(0,l.ZP)(d.Z,{name:"MuiIconButton",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:r}=e;return[t.root,"default"!==r.color&&t["color".concat((0,p.Z)(r.color))],r.edge&&t["edge".concat((0,p.Z)(r.edge))],t["size".concat((0,p.Z)(r.size))]]}})(e=>{let{theme:t,ownerState:r}=e;return(0,o.Z)({textAlign:"center",flex:"0 0 auto",fontSize:t.typography.pxToRem(24),padding:8,borderRadius:"50%",overflow:"visible",color:(t.vars||t).palette.action.active,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest})},!r.disableRipple&&{"&:hover":{backgroundColor:t.vars?"rgba(".concat(t.vars.palette.action.activeChannel," / ").concat(t.vars.palette.action.hoverOpacity,")"):(0,s.Fq)(t.palette.action.active,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"start"===r.edge&&{marginLeft:"small"===r.size?-3:-12},"end"===r.edge&&{marginRight:"small"===r.size?-3:-12})},e=>{var t;let{theme:r,ownerState:n}=e,a=null==(t=(r.vars||r).palette)?void 0:t[n.color];return(0,o.Z)({},"inherit"===n.color&&{color:"inherit"},"inherit"!==n.color&&"default"!==n.color&&(0,o.Z)({color:null==a?void 0:a.main},!n.disableRipple&&{"&:hover":(0,o.Z)({},a&&{backgroundColor:r.vars?"rgba(".concat(a.mainChannel," / ").concat(r.vars.palette.action.hoverOpacity,")"):(0,s.Fq)(a.main,r.palette.action.hoverOpacity)},{"@media (hover: none)":{backgroundColor:"transparent"}})}),"small"===n.size&&{padding:5,fontSize:r.typography.pxToRem(18)},"large"===n.size&&{padding:12,fontSize:r.typography.pxToRem(28)},{["&.".concat(m.disabled)]:{backgroundColor:"transparent",color:(r.vars||r).palette.action.disabled}})});var x=a.forwardRef(function(e,t){let r=(0,u.i)({props:e,name:"MuiIconButton"}),{edge:a=!1,children:i,className:s,color:l="default",disabled:d=!1,disableFocusRipple:p=!1,size:h="medium"}=r,v=(0,n.Z)(r,y),f=(0,o.Z)({},r,{edge:a,color:l,disabled:d,disableFocusRipple:p,size:h}),m=Z(f);return(0,g.jsx)(b,(0,o.Z)({className:(0,c.Z)(m.root,s),centerRipple:!0,focusRipple:!p,disabled:d,ref:t},v,{ownerState:f,children:i}))})},9998:function(e,t,r){"use strict";r.d(t,{Z:function(){return g}});var n=r(9241),o=r(3460),a=r(3098),c=r(8153),i=r(9337),s=r(137),l=r(4593),u=r(2305),d=r(270),p=r(4696),h=r(335),v=r(468),f=r(511),m=r(6548);function g(e){let{onCancel:t}=e,[r]=(0,o.fl)(),g=(0,c.PQ)(c.YI.primary.getArgb(r.scheme));(0,c.PQ)(c.YI.surface.getArgb(r.scheme));let y=(0,c.PQ)(c.YI.surfaceContainer.getArgb(r.scheme));return(0,n.tZ)(l.Z,{open:!0,css:(0,a.iv)({zIndex:9999,backgroundColor:(0,u.Fq)("#000",.7),backdropFilter:"blur(4px)"}),children:(0,n.tZ)(d.Z,{css:(0,a.iv)({backgroundColor:y,maxWidth:"400px",width:"90%",margin:"0 16px"}),children:(0,n.BX)(p.Z,{css:(0,a.iv)({display:"flex",flexDirection:"column",alignItems:"center",padding:"32px",textAlign:"center",position:"relative"}),children:[(0,n.tZ)(h.Z,{onClick:t,css:(0,a.iv)({position:"absolute",top:"8px",right:"8px"}),children:(0,n.tZ)(i.Z,{})}),(0,n.tZ)(s.Z,{css:(0,a.iv)({fontSize:"48px",color:g,marginBottom:"16px"})}),(0,n.tZ)(v.Z,{css:(0,a.iv)({color:g,marginBottom:"16px"})}),(0,n.tZ)(f.Z,{variant:"h6",css:(0,a.iv)({marginBottom:"8px"}),children:"決済処理中..."}),(0,n.tZ)(f.Z,{variant:"body1",css:(0,a.iv)({marginBottom:"16px"}),children:"新しいタブで決済を続行してください"}),(0,n.tZ)(f.Z,{variant:"body2",color:"textSecondary",css:(0,a.iv)({marginBottom:"24px"}),children:"決済が完了すると自動的にこの画面は閉じられます"}),(0,n.tZ)(m.Z,{variant:"outlined",onClick:t,css:(0,a.iv)({borderColor:g,color:g}),children:"キャンセル"})]})})})}},6091:function(e,t,r){"use strict";r.d(t,{s:function(){return c}});var n=r(4299),o=r(5041),a=r(2265);let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,a.useState)(!1),[c,i]=(0,a.useState)(!1),s=(0,a.useRef)(null),l=(0,a.useRef)(null),[u]=(0,n.mN)();return(0,a.useEffect)(()=>("BroadcastChannel"in window&&(l.current=new BroadcastChannel("payment-status"),l.current.onmessage=t=>{if(console.log("Payment message received:",t.data),"PAYMENT_COMPLETE"===t.data.type){var n,a,c;if(r(!1),i(!1),"success"===t.data.status)(0,o.yv)("チケットの購入が完了しました！",{variant:"success"}),null===(n=e.onPaymentSuccess)||void 0===n||n.call(e);else if("cancel"===t.data.status)(0,o.yv)("支払いがキャンセルされました。",{variant:"info"}),null===(a=e.onPaymentCancel)||void 0===a||a.call(e);else if("error"===t.data.status){let t="支払いの処理中にエラーが発生しました。";(0,o.yv)(t,{variant:"error"}),null===(c=e.onPaymentError)||void 0===c||c.call(e,t)}}}),()=>{l.current&&l.current.close()}),[e]),(0,a.useEffect)(()=>{if(!t||!s.current)return;let e=setInterval(()=>{var t;(null===(t=s.current)||void 0===t?void 0:t.closed)&&(clearInterval(e),r(!1),i(!1),console.log("Payment tab was closed by user"))},1e3);return()=>clearInterval(e)},[t]),{waitingForPayment:t,purchaseRunning:c,handlePurchase:(0,a.useCallback)(async()=>{i(!0);let t=u.apiGatewayUrl,n=u.apiClient.getAccessToken(),a=window.location.origin;try{if(s.current=window.open("".concat(a,"/payment-prepare"),"_blank"),!s.current)throw Error("新しいタブを開けませんでした。ポップアップブロックを無効にしてください。");r(!0);let c=t=>{if("PAYMENT_PREPARE_READY"===t.data.type)console.log("Payment prepare page is ready"),l();else if("PAYMENT_CANCELED"===t.data.type){var n;console.log("Payment was canceled from prepare page"),r(!1),i(!1),null===(n=e.onPaymentCancel)||void 0===n||n.call(e)}},l=async()=>{try{let e=await fetch("".concat(t,"/payments/checkout-session"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({success_url:"".concat(a,"/payment-success?session_id={CHECKOUT_SESSION_ID}"),cancel_url:"".concat(a,"/payment-cancel"),ticketQuantity:1})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let r=await e.json();console.log("Checkout Session created:",r);let{checkout_url:o}=r;s.current&&!s.current.closed&&s.current.postMessage({type:"STRIPE_URL",url:o},"*")}catch(n){var c;console.error("Checkout session creation failed:",n),s.current&&!s.current.closed&&s.current.postMessage({type:"PAYMENT_ERROR",message:"決済ページの準備に失敗しました。"},"*");let t="購入に失敗しました。もう一度お試しください。";(0,o.yv)(t,{variant:"error"}),i(!1),r(!1),null===(c=e.onPaymentError)||void 0===c||c.call(e,t)}};window.addEventListener("message",c),setTimeout(()=>{window.removeEventListener("message",c)},6e4)}catch(r){var c;console.error("Purchase failed:",r);let t=r instanceof Error&&r.message.includes("タブ")?r.message:"購入に失敗しました。もう一度お試しください。";(0,o.yv)(t,{variant:"error"}),i(!1),null===(c=e.onPaymentError)||void 0===c||c.call(e,t)}},[u,e]),handleCancelPayment:(0,a.useCallback)(()=>{s.current&&!s.current.closed&&s.current.close(),r(!1),i(!1)},[])}}},4299:function(e,t,r){"use strict";r.d(t,{Er:function(){return m},NZ:function(){return u},ZP:function(){return a},mN:function(){return v},xh:function(){return c}});var n=r(9241),o=r(2265);let a="ap-northeast-3_MHzKaeUD4",c="6sdbfpo82ihpb97v8kgo7d8jr8",i="https://dnoqck0cue.execute-api.ap-northeast-3.amazonaws.com/prod",s="".concat(i,"/services/current"),l={"ssr.broken-database":"データベースが破損しています。","ssr.incompatible-extension":"データに互換性のない拡張子が含まれています。","ssr.extension-unmatched":"拡張子が一致しません。","ssr.load-failure":"データの読み込みに失敗しました。","ssr.incompatible-npl":"データのNPLスタイルが互換性がありません。","ssr.file-info-unmatched":"ファイル間でNPL情報が統一されていません。","ssr.data-info-unmatched":"データ間でNPL情報が統一されていません。","ssr.data-size-unmatched":"データ間でサイズが統一されていません。","ssr.incorrect-parameters":"パラメータの指定が正しくありません。","ssr.get-mean-failure":"平均値の取得に失敗しました。","ssr.fitting-failure":"フィッティングに失敗しました。","ssr.wrong-fitting-result":"フィッティング結果が妥当ではありません。","ssr.out-of-memory":"メモリ不足です。","ssr.grid-contains-outside":"予想される位置が範囲外に含まれています。","ssr.others":"不明なエラーが発生しました。","ticket.consume-failed":"計算チケットが不足しています。"};async function u(e){if(e.ok)return;if(404===e.status)return"通信先が見つかりませんでした(404)。";let t=await e.text();try{let e=JSON.parse(t);console.log(e);let r=function(e){if(void 0==e)return;let t=e.detail;if(void 0==t)return;let r=t.code,n=t.message;if(void 0!=r&&void 0!=n&&"string"==typeof r&&"string"==typeof n)return l[r]||n}(e);if(void 0!=r)return r}catch(e){console.warn("Failed to parse error response",e)}return"エラーが発生しました。".concat(e.status,": ").concat(t)}let d=(0,o.createContext)({apiClient:f(i,s,null),apiGatewayUrl:i,serviceStatus:"configuring"}),p=(0,o.createContext)(()=>{}),h=(e,t)=>"setServiceStatus"===t.type?{...e,serviceStatus:t.payload.status}:e,v=()=>{let e=(0,o.useContext)(d),t=(0,o.useContext)(p);return(0,o.useRef)(e).current=e,[e,(0,o.useMemo)(()=>({setServiceStatus:e=>{t({type:"setServiceStatus",payload:{status:e}})}}),[])]};function f(e,t,r){let n=async(e,n,o)=>{let a=n.length>0?"?"+n.join("&"):"",c="".concat(t,"/").concat(e).concat(a),i=new Headers(null==o?void 0:o.headers);return r&&i.set("Authorization","Bearer ".concat(r)),fetch(c,{...o,headers:i})};return console.log("makeApiClient()"),{serviceFetch:async(e,t,r)=>n(e,t,r),setNewAccessToken:e=>{r=e,localStorage.setItem("token",e)},getAccessToken:()=>r,restoreServiceSession:async()=>{r=localStorage.getItem("token");try{let e=await n("hello",[]);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status))}catch(e){return console.error(e),!1}return!0}}}function m(e){let{children:t}=e,r=(0,o.useMemo)(()=>f(i,s,null),[]),[a,c]=(0,o.useReducer)(h,{apiClient:r,apiGatewayUrl:i,serviceStatus:"configuring"}),l=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{if(!l.current)return async function(){try{let e=await a.apiClient.restoreServiceSession();console.log("restoreServiceSession",e),e?c({type:"setServiceStatus",payload:{status:"connected"}}):c({type:"setServiceStatus",payload:{status:"not-login"}})}catch(e){console.error(e),c({type:"setServiceStatus",payload:{status:"not-login"}})}}(),()=>{l.current=!0}},[]),(0,n.tZ)(d.Provider,{value:a,children:(0,n.tZ)(p.Provider,{value:c,children:t})})}},3460:function(e,t,r){"use strict";r.d(t,{ThemeStoreProvider:function(){return m},fl:function(){return v}});var n=r(9241),o=r(8438),a=r.n(o),c=r(9380),i=r(2686),s=r(1705),l=r(8153),u=r(2265),d=r(1246);let p=(0,u.createContext)({scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}),h=(0,u.createContext)(()=>{}),v=()=>{let e=(0,u.useContext)(p),t=(0,u.useContext)(h);return[e,{resetSourceColor:()=>{t({type:"setTheme",payload:{scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}})}}]},f=(e,t)=>{if("setTheme"===t.type){let{scheme:r,sourceColor:n}=t.payload;return e.sourceColor===n?e:{...e,scheme:r,sourceColor:n}}return e},m=e=>{let{children:t}=e,[r,o]=(0,u.useReducer)(f,{scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}),v=(0,c.Z)((0,i.Z)({palette:{mode:"light",primary:{main:(0,l.PQ)(l.YI.primary.getArgb(r.scheme))},secondary:{main:(0,l.PQ)(l.YI.secondary.getArgb(r.scheme))},background:{default:(0,l.PQ)(l.YI.surface.getArgb(r.scheme)),paper:(0,l.PQ)(l.YI.surfaceContainer.getArgb(r.scheme))},error:{main:(0,l.PQ)(l.YI.error.getArgb(r.scheme))},text:{primary:(0,l.PQ)(l.YI.onSurface.getArgb(r.scheme))}},typography:{fontFamily:a().style.fontFamily}}));return(0,n.BX)(s.Z,{theme:v,children:[(0,n.tZ)(d.Z,{styles:e=>({body:{transition:e.transitions.create(["background-color","transform"])}})}),(0,n.tZ)(p.Provider,{value:r,children:(0,n.tZ)(h.Provider,{value:o,children:t})})]})}}},function(e){e.O(0,[1665,9241,526,2036,1650,3676,5981,1892,933,2971,7023,1744],function(){return e(e.s=6102)}),_N_E=e.O()}]);