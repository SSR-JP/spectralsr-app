(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8926],{75:function(e,t,r){Promise.resolve().then(r.bind(r,9091))},9091:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _}});var a=r(9241),n=r(1326),s=r(4990),i=r(511),o=r(8409),l=r(4526),c=r(4583),u=r(49),d=r(2265),h=r(7818),p=r(3098),f=r(6463),v=r(2331),g=r(3457),y=r(4326),m=r(9278),S=r(4671),x=r(4299),I=r(4980);let w=(0,h.default)(()=>Promise.all([r.e(5934),r.e(9109),r.e(2008)]).then(r.bind(r,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function _(){let e=(0,f.useRouter)(),[t,r]=(0,S.P2)(),[h]=(0,x.mN)(),_=h.apiClient,[R,Z]=(0,d.useState)(10),[b,k]=(0,d.useState)(""),[D,C]=(0,d.useState)(""),[z,N]=(0,d.useState)(""),[P,F]=(0,d.useState)(!0),[L,M]=(0,d.useState)([0,0]),[A,B]=(0,d.useState)(0),[O,E]=(0,d.useState)([]),{setActiveStep:T}=(0,v.b)(),[X]=(0,I.Ay)(),j=X.originalDataset,G=e=>{Z(e.optimize_iterations),M(e.sr_range),k(e.sr_interval_distance),C(e.search_interval_distance),N(e.search_iterations),r.setOptimizeIterations(e.optimize_iterations),r.setSrRange(e.sr_range),r.setSrIntervalDistance(e.sr_interval_distance),r.setSearchIntervalDistance(e.search_interval_distance),r.setSearchIterations(e.search_iterations),r.setRho(e.rho)},K=e=>{Z(e.optimize_iterations),M(e.sr_range),k(e.sr_interval_distance),C(e.search_interval_distance),N(e.search_iterations),r.setOptimizeIterations(e.optimize_iterations),r.setSrRange(e.sr_range),r.setSrIntervalDistance(e.sr_interval_distance),r.setSearchIntervalDistance(e.search_interval_distance),r.setSearchIterations(e.search_iterations)};return(0,d.useEffect)(()=>{P&&"string"!=typeof b&&_.serviceFetch("dataset/ssr/settings/preferred",["sr_interval_distance=".concat(b)]).then(e=>e.json()).then(e=>(C(e.search_interval_distance),N(e.search_iterations),null)).catch(e=>console.error(e))},[P,b]),(0,d.useEffect)(()=>{if(T(2),"loaded"!==X.status){e.push("/");return}let t=j.filter(e=>e.using),{samplesX:r}=t[0],a=r.map((e,r)=>t.map(e=>e.samplesY[r]).sort((e,t)=>e-t));E((0,m.T)(r,a)),(async()=>{try{let e=await _.serviceFetch("dataset/ssr/settings/latest",[]),t=await e.json();if((null==t?void 0:t.rho)!==void 0){G(t),console.log("Loaded latest SSR settings with rho:",t);return}}catch(e){console.log("No latest settings, loading preferred...")}try{let e=await _.serviceFetch("dataset/ssr/settings/preferred",[]),t=await e.json();K(t),console.log("Loaded preferred SSR settings (rho_range):",t)}catch(e){console.error("Failed to load settings:",e)}})(),_.serviceFetch("dataset/ssr/settings/info",[]).then(e=>e.json()).then(e=>(B(e.original_interval_distance),null)).catch(e=>console.error(e))},[]),(0,a.tZ)(g.T,{onNext:()=>{if(X.isLocked){e.push("/calc/rho-optimize");return}"string"!=typeof b&&"string"!=typeof D&&"string"!=typeof z&&(t.optimizeIterations!==R&&r.setOptimizeIterations(R),JSON.stringify(t.srRange)!==JSON.stringify(L)&&r.setSrRange(L),t.srIntervalDistance!==b&&r.setSrIntervalDistance(b),t.searchIntervalDistance!==D&&r.setSearchIntervalDistance(D),t.searchIterations!==z&&r.setSearchIterations(z),e.push("/calc/rho-optimize"))},onBack:()=>e.push("/calc/fitting"),children:(0,a.BX)(n.Z,{sx:{display:"grid",gap:1,height:{sm:"auto",md:"100%"},gridTemplateColumns:{sm:"1fr",md:"2fr 1fr"},gridTemplateRows:{sm:"1fr 1fr",md:"1fr"}},children:[(0,a.tZ)("div",{css:(0,p.iv)({display:"flex",justifyContent:"center"}),children:(0,a.tZ)(w,{data:O,layout:{width:640,height:400}})}),(0,a.BX)(s.Z,{sx:{p:2,overflowY:"scroll"},children:[(0,a.tZ)(y.Ki,{label:"超解像度後の測定間隔",disabled:X.isLocked,fullWidth:!0,value:b,onChange:e=>{k(e)},validator:(0,y.rB)(3)}),(0,a.BX)(i.Z,{variant:"body2",sx:{mt:1},children:["超解像前の測定間隔:"," ",parseFloat(A.toFixed(3))]}),(0,a.BX)(o.Z,{component:"legend",sx:{mt:3,display:"flex",alignItems:"center"},children:[(0,a.tZ)("span",{style:{flexGrow:1},children:"θ探索"}),(0,a.tZ)(l.Z,{disabled:X.isLocked,control:(0,a.tZ)(c.Z,{checked:P,onChange:e=>{F(e.target.checked)}}),label:"Auto",labelPlacement:"start"})]}),(0,a.BX)(u.Z,{children:[(0,a.tZ)(y.Ki,{disabled:X.isLocked||P,label:"探索間隔",sx:{mt:1},value:D,onChange:e=>{C(e)},validator:(0,y.rB)(3)}),(0,a.tZ)(y.Ki,{disabled:X.isLocked||P,label:"探索点数",sx:{mt:1},value:z,onChange:e=>{N(e)}})]})]})]})})}},2331:function(e,t,r){"use strict";r.d(t,{I:function(){return n},b:function(){return s}});var a=r(2265);let n=a.createContext(void 0),s=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useAppContext must be used within an AppProvider");return e}},4326:function(e,t,r){"use strict";r.d(t,{Ki:function(){return i},rB:function(){return s}});var a=r(9241),n=r(6858);function s(e){return t=>parseFloat(Number(t).toPrecision(e))}let i=(0,r(2265).forwardRef)(function(e,t){let{label:r,value:s,onChange:i,onBlur:o=()=>{},validator:l,disabled:c,...u}=e,d=null!=l?l:e=>parseFloat(Number(e).toFixed(3));return(0,a.tZ)(n.Z,{disabled:c,ref:t,label:r,value:"number"==typeof s?d(s):s,onChange:e=>{i(e.target.value)},onBlur:e=>{i(d(e.target.value)),null==o||o()},onKeyDown:e=>{let t=e.target;"Enter"===e.key&&i(d(t.value))},...u})})},3457:function(e,t,r){"use strict";r.d(t,{T:function(){return i}});var a=r(9241),n=r(1326),s=r(6548);function i(e){let{children:t,onNext:r,onBack:i}=e;return(0,a.BX)(n.Z,{sx:{flexGrow:1,boxSizing:"border-box",overflow:"auto",display:"flex",flexDirection:"column"},children:[(0,a.tZ)(n.Z,{sx:{padding:2,overflowY:"overlay",flexGrow:1},children:t}),(0,a.BX)(n.Z,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:[(0,a.tZ)(s.Z,{sx:{m:1},variant:"outlined",onClick:i,disabled:!i,children:"もどる"}),(0,a.tZ)(s.Z,{sx:{m:1},variant:"contained",onClick:r,disabled:!r,children:"つぎへ"})]})]})}i.defaultProps={onNext:void 0,onBack:void 0}},9278:function(e,t,r){"use strict";r.d(t,{T:function(){return s}});var a=r(2592);function n(e,t){let r=t/100*(e.length-1),a=Math.floor(r),n=a+1,s=r%1;return n>=e.length?e[a]:e[a]*(1-s)+e[n]*s}function s(e,t){let r={x:[...e,...e.toReversed()],y:[...t.map(e=>n(e,0)),...t.map(e=>n(e,100)).reverse()],fill:"toself",fillcolor:a.Z[50],line:{width:0},type:"scatter",showlegend:!1},s={x:[...e,...e.toReversed()],y:[...t.map(e=>n(e,10)),...t.map(e=>n(e,90)).reverse()],fill:"toself",fillcolor:a.Z[100],line:{width:0},type:"scatter",showlegend:!1},i={x:[...e,...e.toReversed()],y:[...t.map(e=>n(e,20)),...t.map(e=>n(e,80)).reverse()],fill:"toself",fillcolor:a.Z[200],line:{width:0},type:"scatter",showlegend:!1};return[r,s,i,{x:[...e,...e.toReversed()],y:[...t.map(e=>n(e,30)),...t.map(e=>n(e,70)).reverse()],fill:"toself",fillcolor:a.Z[300],line:{width:0},type:"scatter",showlegend:!1},{x:[...e,...e.toReversed()],y:[...t.map(e=>n(e,40)),...t.map(e=>n(e,60)).reverse()],fill:"toself",fillcolor:a.Z[400],line:{width:0},type:"scatter",showlegend:!1},{x:e,y:null==t?void 0:t.map(e=>n(e,50)),mode:"lines",marker:{color:a.Z[500]},showlegend:!1}]}},4980:function(e,t,r){"use strict";r.d(t,{Ay:function(){return o},GX:function(){return c}});var a=r(9241),n=r(2265);let s=(0,n.createContext)({status:"unset",name:"",originalDataset:[],isLocked:!0}),i=(0,n.createContext)(()=>{}),o=()=>{let e=(0,n.useContext)(s),t=(0,n.useContext)(i);return[e,(0,n.useMemo)(()=>({setName:e=>{t({type:"setName",payload:e})},setOriginalDataset:e=>{t({type:"setOriginalDataset",payload:e})},setDatasetStatus:e=>{t({type:"setDatasetStatus",payload:e})},setIsLocked:e=>{t({type:"setIsLocked",payload:e})}}),[])]},l=(e,t)=>{switch(t.type){case"setName":return{...e,name:t.payload};case"setOriginalDataset":return{...e,originalDataset:t.payload};case"setDatasetStatus":return{...e,status:t.payload};case"setIsLocked":return{...e,isLocked:t.payload};default:return e}};function c(e){let{children:t}=e,[r,o]=(0,n.useReducer)(l,{status:"unset",name:"",originalDataset:[],isLocked:!0});return(0,a.tZ)(s.Provider,{value:r,children:(0,a.tZ)(i.Provider,{value:o,children:t})})}},4299:function(e,t,r){"use strict";r.d(t,{Er:function(){return g},NZ:function(){return u},ZP:function(){return s},mN:function(){return f},xh:function(){return i}});var a=r(9241),n=r(2265);let s="ap-northeast-3_Co9bfTpos",i="4btom5t4l9d6qkf643fb99t5mv",o="https://qzatinbkh5.execute-api.ap-northeast-3.amazonaws.com/dev",l="".concat(o,"/services/current"),c={"ssr.broken-database":"データベースが破損しています。","ssr.incompatible-extension":"データに互換性のない拡張子が含まれています。","ssr.extension-unmatched":"拡張子が一致しません。","ssr.load-failure":"データの読み込みに失敗しました。","ssr.incompatible-npl":"データのNPLスタイルが互換性がありません。","ssr.file-info-unmatched":"ファイル間でNPL情報が統一されていません。","ssr.data-info-unmatched":"データ間でNPL情報が統一されていません。","ssr.data-size-unmatched":"データ間でサイズが統一されていません。","ssr.incorrect-parameters":"パラメータの指定が正しくありません。","ssr.get-mean-failure":"平均値の取得に失敗しました。","ssr.fitting-failure":"フィッティングに失敗しました。","ssr.wrong-fitting-result":"フィッティング結果が妥当ではありません。","ssr.out-of-memory":"メモリ不足です。","ssr.grid-contains-outside":"予想される位置が範囲外に含まれています。","ssr.others":"不明なエラーが発生しました。","ticket.consume-failed":"計算チケットが不足しています。"};async function u(e){if(e.ok)return;if(404===e.status)return"通信先が見つかりませんでした(404)。";let t=await e.text();try{let e=JSON.parse(t);console.log(e);let r=function(e){if(void 0==e)return;let t=e.detail;if(void 0==t)return;let r=t.code,a=t.message;if(void 0!=r&&void 0!=a&&"string"==typeof r&&"string"==typeof a)return c[r]||a}(e);if(void 0!=r)return r}catch(e){console.warn("Failed to parse error response",e)}return"エラーが発生しました。".concat(e.status,": ").concat(t)}let d=(0,n.createContext)({apiClient:v(o,l,null),apiGatewayUrl:o,serviceStatus:"configuring"}),h=(0,n.createContext)(()=>{}),p=(e,t)=>"setServiceStatus"===t.type?{...e,serviceStatus:t.payload.status}:e,f=()=>{let e=(0,n.useContext)(d),t=(0,n.useContext)(h);return(0,n.useRef)(e).current=e,[e,(0,n.useMemo)(()=>({setServiceStatus:e=>{t({type:"setServiceStatus",payload:{status:e}})}}),[])]};function v(e,t,r){let a=async(e,a,n)=>{let s=a.length>0?"?"+a.join("&"):"",i="".concat(t,"/").concat(e).concat(s),o=new Headers(null==n?void 0:n.headers);return r&&o.set("Authorization","Bearer ".concat(r)),fetch(i,{...n,headers:o})};return console.log("makeApiClient()"),{serviceFetch:async(e,t,r)=>a(e,t,r),setNewAccessToken:e=>{r=e,localStorage.setItem("token",e)},getAccessToken:()=>r,restoreServiceSession:async()=>{r=localStorage.getItem("token");try{let e=await a("hello",[]);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status))}catch(e){return console.error(e),!1}return!0}}}function g(e){let{children:t}=e,r=(0,n.useMemo)(()=>v(o,l,null),[]),[s,i]=(0,n.useReducer)(p,{apiClient:r,apiGatewayUrl:o,serviceStatus:"configuring"}),c=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{if(!c.current)return async function(){try{let e=await s.apiClient.restoreServiceSession();console.log("restoreServiceSession",e),e?i({type:"setServiceStatus",payload:{status:"connected"}}):i({type:"setServiceStatus",payload:{status:"not-login"}})}catch(e){console.error(e),i({type:"setServiceStatus",payload:{status:"not-login"}})}}(),()=>{c.current=!0}},[]),(0,a.tZ)(d.Provider,{value:s,children:(0,a.tZ)(h.Provider,{value:i,children:t})})}},4671:function(e,t,r){"use strict";r.d(t,{L7:function(){return c},P2:function(){return o}});var a=r(9241),n=r(2265);let s=(0,n.createContext)({fittingFunction:"",peakRange:[],noiseRange:[],optimizeIterations:0,srIntervalDistance:0,searchIntervalDistance:0,searchIterations:0,rho:0,rhoMax:0,rhoMin:0,searchSettingsAuto:!0,rhoSettingsAuto:!0,srRange:[0,0],originalIntervalDistance:0,plotData:[],progressIndicatorActive:!1}),i=(0,n.createContext)(()=>{}),o=()=>{let e=(0,n.useContext)(s),t=(0,n.useContext)(i);return[e,{setOptimizeIterations:e=>t({type:"setOptimizeIterations",payload:e}),setSrRange:e=>t({type:"setSrRange",payload:e}),setSrIntervalDistance:e=>t({type:"setSrIntervalDistance",payload:e}),setSearchIntervalDistance:e=>t({type:"setSearchIntervalDistance",payload:e}),setSearchIterations:e=>t({type:"setSearchIterations",payload:e}),setRhoMax:e=>t({type:"setRhoMax",payload:e}),setRhoMin:e=>t({type:"setRhoMin",payload:e}),setRho:e=>t({type:"setRho",payload:e})}]},l=(e,t)=>{switch(t.type){case"setFittingFunction":return{...e,fittingFunction:t.payload};case"setOptimizeIterations":return{...e,optimizeIterations:t.payload};case"setSrRange":return console.log("@@@ setSrRange",t.payload),{...e,srRange:t.payload};case"setSrIntervalDistance":return{...e,srIntervalDistance:t.payload};case"setSearchIntervalDistance":return{...e,searchIntervalDistance:t.payload};case"setSearchIterations":return{...e,searchIterations:t.payload};case"setRhoMax":return{...e,rhoMax:t.payload};case"setRhoMin":return{...e,rhoMin:t.payload};case"setRho":return{...e,rho:t.payload};default:throw Error("Invalid action type")}};function c(e){let{children:t}=e,[r,o]=(0,n.useReducer)(l,{fittingFunction:"",peakRange:[],noiseRange:[],optimizeIterations:0,srIntervalDistance:0,searchIntervalDistance:0,searchIterations:0,rho:0,rhoMax:0,rhoMin:0,searchSettingsAuto:!0,rhoSettingsAuto:!0,srRange:[0,0],originalIntervalDistance:0,plotData:[],progressIndicatorActive:!1});return(0,a.tZ)(s.Provider,{value:r,children:(0,a.tZ)(i.Provider,{value:o,children:t})})}}},function(e){e.O(0,[9241,526,1650,5981,4692,5380,659,5971,7025,4946,2971,7023,1744],function(){return e(e.s=75)}),_N_E=e.O()}]);